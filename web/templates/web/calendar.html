<!-- –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
<!--  -->
{% extends 'web/base.html' %}
{% block content %}
<!-- TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –º–∞–∫–µ—Ç–æ–º –∏ models.py -->
<h1>–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫</h1>

<div id="timeline" style="height: 400px; border: 1px solid #ccc; border-radius: 8px;"></div>

<!-- Vis.js -->
<link href="https://unpkg.com/vis-timeline@7.7.0/styles/vis-timeline-graph2d.min.css" rel="stylesheet" />
<script src="https://unpkg.com/vis-timeline@7.7.0/standalone/umd/vis-timeline-graph2d.min.js"></script>

<style>
    #timeline {
        height: 600px;
        min-height: 400px;
        border: 1px solid #ccc;
    }

    .vis-time-axis .vis-grid.vis-day {
        background: rgba(0, 0, 0, 0.05);
    }

    .vis-item {
        font-size: 14px;
        padding: 4px;
    }

    .no-tasks-message {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 18px;
        color: #666;
    }
</style>

{% now "Y-m-d\\TH:i:s" as today %}
{% now "U" as now_ts %}
{% with future_ts=now_ts|add:"2592000" %} {# 30 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥ #}
{% with future_date=future_ts|date:"Y-m-d\\TH:i:s" %}

<script>
    const container = document.getElementById('timeline');

    const items = [
        {% for task in tasks %}
        {
            id: {{ task.id }},
            content: `<strong>{{ task.title|escapejs }}</strong><br>
                      {{ task.user.fio|escapejs }}{% if task.priority == 3 %}<br><em>üî∫ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</em>{% elif task.priority == 2 %}<br><em>‚ö† –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</em>{% else %}<br><em>üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</em>{% endif %}`,
            start: "{{ task.date_added|date:'Y-m-d\\TH:i:s' }}",
            {% if task.deadline %}
            end: "{{ task.deadline|date:'Y-m-d\\TH:i:s' }}",
            {% endif %}
            className: "{% if task.priority == 3 %}high{% elif task.priority == 2 %}medium{% else %}low{% endif %}"
        },
        {% endfor %}
    ];

    // –ü–æ–ª—É—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∏ –¥–∏–∞–ø–∞–∑–æ–Ω +/- 1 –º–µ—Å—è—Ü
    const today = new Date();
    const startDate = new Date(today);
    const endDate = new Date(today);
    startDate.setMonth(today.getMonth() - 1);
    endDate.setMonth(today.getMonth() + 1);

    const options = {
    start: startDate,
    end: endDate,
    stack: true,
    horizontalScroll: true,
    zoomKey: 'ctrlKey',
    maxHeight: '600px',
    minHeight: '400px',
    zoomMin: 1000 * 60 * 60 * 24 * 2,       // 2 –¥–Ω—è
    zoomMax: 1000 * 60 * 60 * 24 * 30,      // 30 –¥–Ω–µ–π
    showCurrentTime: true,
    timeAxis: {
        scale: 'day',
        step: 1,
        format: {
            minorLabels: {
                day: 'D',
                month: 'MMM',
                year: 'YYYY'
            },
            majorLabels: {
                day: 'MMMM YYYY',
                month: 'YYYY',
                year: ''
            }
        }
    },
    orientation: 'both',
    editable: false,
    multiselect: false,
    };


    const timeline = new vis.Timeline(container, items, options);

    if (items.length === 0) {
        const message = document.createElement('div');
        message.className = 'no-tasks-message';
        message.innerText = "–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –û—Ç–æ–±—Ä–∞–∑–∏–º –ø—É—Å—Ç–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å.";
        container.appendChild(message);
    }
</script>
{% endwith %}
{% endwith %}
{% endblock %}